jQuery(document).ready(function(t){function o(e){t(".peek-a-bar").hide().remove(),new t.peekABar({padding:"1em",animation:{type:"fade",duration:1e3},cssClass:"ssp-notification-bar",backgroundColor:"#4aa3df"}).show({html:e})}var e,s;"undefined"!=typeof upload_credentials&&(e={runtimes:"html5",browse_button:"ssp_select_file",multi_selection:!1,container:"ssp_upload_container",url:upload_credentials.castos_api_url+"files"},(s=new plupload.Uploader(e)).init(),s.bind("Init",function(){t("#ssp_upload_notification").remove()}),s.bind("FilesAdded",function(e,i){var a,t=i[0];i=(a=t).type.split("/"),a=!1,"audio"!==i[0]&&"video"!==i[0]||(a=!0),a?(o('Uploading file to Castos Hosting. You can continue editing this post while the file uploads. <b id="ssp_upload_progress"></b>'),s.start()):(o("You have selected an invalid file type, please select a valid audio or video file."),s.removeFile(t))}),s.bind("BeforeUpload",function(e,i){i=i.name.replace(/[,\/#!$%\^&\*;:{}=\-_`'~()+"|? ]/g," ").replace(/\s{1,}/g,"-"),i={token:upload_credentials.castos_api_token,episode_id:upload_credentials.castos_episode_id,file_name:i};s.settings.multipart_params=i}),s.bind("Error",function(e,i){let a=i.message;try{let e=JSON.parse(i.response);"object"==typeof e&&e.hasOwnProperty("message")&&(a=e.message)}catch(e){}alert("Error: "+a)}),s.bind("UploadProgress",function(e,i){t("#ssp_upload_progress").html(i.percent+"%"),100===i.percent&&o("Processing Castos Hosting file.")}),s.bind("FileUploaded",function(e,i,a){o("Uploading file to Castos Hosting Complete.");a=JSON.parse(a.response);200===a.status&&(i=a.file,e=e.files[0].name,t("#podmotor_file_id").val(i.id).trigger("change"),t("#filesize_raw").val(i.file_size).trigger("change"),t("#filesize").val(plupload.formatSize(i.file_size)).trigger("change"),t("#duration").val(i.file_duration).trigger("change"),t("#upload_audio_file").val(i.file_path).trigger("change"),t(".peek-a-bar").fadeOut(5e3),t("#castos_file_data").val(JSON.stringify({path:i.file_path,name:e})),t("#castos_file_name").html(e).parent().show()),s.splice()}),s.bind("UploadComplete",function(e,i){t(".peek-a-bar").fadeOut(5e3)}))});